# EDA

## Univariate Analysis

Examine each variable individually to understand its distribution, central tendency, and spread.

```{python}
# Code visibility controlled by format settings in report.qmd
import pandas as pd
import numpy as np
import warnings
import matplotlib.pyplot as plt
import seaborn as sns
import plotly as py
import plotly.graph_objs as go
import statistics
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import plotly.express as px

url = "https://data.nsw.gov.au/data/dataset/4ff1a0de-9bff-4b45-9f93-5a9bf44df257/resource/5b843384-5aea-4bc4-9935-0dd91ea2559d/download/2020_rws-updated.csv"
df = pd.read_csv(url, encoding="ISO-8859-1")
# delete all the duplicated rows
df[df.duplicated(keep=False)]

# delete all the columns with think are not significant to lower the size of the dataset for better readibility
cols_to_drop = [0,4, 6, 11, 14, 15, 16, 18, 22, 23, 24, 26, 28, 29, 30, 31] + list(range(41, 73))
df = df.drop(df.columns[cols_to_drop], axis=1)

# Rename column
rename_map = {
    "Response ID": "Response_ID",
    "What year were you born?": "Age",
    "What is your gender?": "Gender",
    "Which of the following best describes your industry?": "Industry",
    "Which of the following best describes your current occupation?": "Job_type",
    "How many people are currently employed by your organisation?": "Organisation_Size",
    "Do you manage people as part of your current occupation?": "Managing_position",
    "Which of the following best describes your household?": "Household",
    "How long have you been in your current job?": "Years_in_job",
    "Thinking about your current job, how much of your time did you spend remote working last year?": "Remote_pct_last_year",
    "Thinking about remote working last year, how strongly do you agree or disagree with the following statements? - My organisation encouraged people to work remotely": "Org_encouraged_remote_last_year",
    "Thinking about remote working last year, how strongly do you agree or disagree with the following statements? - I could easily collaborate with colleagues when working remotely": "Collaboration_remote_last_year",
    "How much of your time would you have preferred to work remotely last year?": "Preferred_remote_last_year",
    "Thinking about your current job, how much of your time did you spend remote working in the last 3 months?": "Remote_pct_last_3_months",
    "Thinking about remote working in the last 3 months, how strongly do you agree or disagree with the following statements? - My organisation encouraged people to work remotely": "Org_encouraged_remote_3_months",
    "Thinking about remote working in the last 3 months, how strongly do you agree or disagree with the following statements? - I could easily collaborate with colleagues when working remotely": "Collaboration_remote_3_months",
    "How much of your time would you have preferred to work remotely in the last 3 months?": "Preferred_remote_3_months",
    "This question is about your productivity. Productivity means what you produce for each hour that you work. It includes the amount of work you achieve each hour, and the quality of your work each hour.  \nPlease compare your productivity when you work remotely to when you work at your employer\x92s workplace.  \nRoughly how productive are you, each hour, when you work remotely?": "Productivity_remote_vs_workplace",
    "On a day when you attend your employer's workplace, how many hours would you spend doing the following activities? - Preparing for work and commuting": "Commute_hours_workplace",
    "On a day when you attend your employer's workplace, how many hours would you spend doing the following activities? - Working": "Working_hours_workplace",
    "On a day when you attend your employer's workplace, how many hours would you spend doing the following activities? - Personal and family time": "Personal_family_hours_workplace",
    "On a day when you attend your employer's workplace, how many hours would you spend doing the following activities? - Caring and domestic responsibilities": "Domestic_hours_workplace",
    "On a day when you do remote work, how many hours would you spend doing the following activities? - Preparing for work and commuting": "Commute_hours_remote",
    "On a day when you do remote work, how many hours would you spend doing the following activities? - Working": "Working_hours_remote",
    "On a day when you do remote work, how many hours would you spend doing the following activities? - Personal and family time": "Personal_family_hours_remote",
    "On a day when you do remote work, how many hours would you spend doing the following activities? - Caring and domestic responsibilities": "Domestic_hours_remote"}
df.rename(columns=rename_map, inplace=True)

# 1. Organisation Size
df["Organisation_Size"] = df["Organisation_Size"].replace({
    "I am the only employee": "Solo business",
    "Between 1 and 4": "Micro enterprise",
    "Between 5 and 19": "Small enterprise",
    "Between 20 and 199": "Medium enterprise",
    "More than 200": "Large / Corporate enterprise"}).fillna("Other / Unspecified")

# 2. Gender & Managing Position
df = df[df["Gender"] != "Rather not say"]
df["Gender"] = df["Gender"].replace({"Male": 0, "Female": 1}).astype("category")
df["Managing_position"] = df["Managing_position"].replace({"No": 0, "Yes": 1}).astype("category")
df = df.dropna(subset=["Managing_position"])

# 3. Age (convert birth year to age in 2020)
df["Age"] = 2020 - df["Age"]

# 4. Years in job
df["Years_in_job"] = df["Years_in_job"].replace({
    "More than 5 years": "5+",
    "Between 1 and 5 years": "5-",
    "Between 6 and 12 months": "1-"})

# 5. Likert scale mapping
likert_mapping = {
    "Strongly disagree": 1,
    "Somewhat disagree": 2,
    "Neither agree nor disagree": 3,
    "Somewhat agree": 4,
    "Strongly agree": 5}
likert_cols = [
    "Org_encouraged_remote_last_year",
    "Collaboration_remote_last_year",
    "Org_encouraged_remote_3_months",
    "Collaboration_remote_3_months"]
df[likert_cols] = df[likert_cols].replace(likert_mapping).fillna(3)

# 6. Remote percentages mapping
remote_mapping = {
    "Rarely or never": 0,
    "Less than 10% of my time": 5,
    "10%": 10,
    "20%": 20,
    "30%": 30,
    "40%": 40,
    "50% - About half of my time": 50,
    "50% - I spent about half of my time remote working": 50,
    "60%": 60,
    "70%": 70,
    "80%": 80,
    "90%": 90,
    "100% - All of my time": 100,
    "100% - I spent all of my time remote working": 100,
    "I would not have preferred to work remotely": 0}
percent_cols = [
    "Preferred_remote_last_year",
    "Remote_pct_last_year",
    "Remote_pct_last_3_months",
    "Preferred_remote_3_months"]
for col in percent_cols:
    df[col] = df[col].astype(str).str.replace("\xa0", "", regex=True).str.strip().replace(remote_mapping)
    df[col] = pd.to_numeric(df[col], errors="coerce") / 100  # Convert to proportion

# 7. Productivity cleaning
def parse_productivity(val):
    if pd.isna(val):
        return None
    val = str(val).replace("\x92", "'")  # Fix apostrophe
    if "more productive" in val:
        return int(val.split("%")[0].replace("I'm ", "").strip())
    elif "less productive" in val:
        return -int(val.split("%")[0].replace("I'm ", "").strip())
    elif "same" in val:
        return 0
    return None
df["Productivity_remote_vs_workplace"] = df["Productivity_remote_vs_workplace"].apply(parse_productivity)
```

From this code we got the full results of all our variables in terms of distribution sorted by occurrence. The relevant information we gathered from these are the followings:

```{python}
print("\n--- Age ---")
print(df["Age"].value_counts(dropna=False))
```

-   Age: we have some outliers for the age variable with 2 people 120 years old that needs to be treated

```{python}
print("\n--- Gender ---")
print(df["Gender"].value_counts(dropna=False))
```

-   Gender: good balance (604 / (604+766) = 44% of women)

```{python}
print("\n--- Years_in_job ---")
print(df["Years_in_job"].value_counts(dropna=False))
```

-   Years in job: sample is quite experienced with only 11% with less than 1 year of experience.

```{python}
print("\n--- Productivity_remote_vs_workplace ---")
print(df["Productivity_remote_vs_workplace"].value_counts(dropna=False))
```

- Productivity remote vs workplace: we can see that for most of them productivity is either equivalent, or they even gained in productivity (46% gained between 20 to 50% of productivity).

## Distribution Plot

Concretely, if we look at the distribution of the change in productivity with this code :  

```{python}
fig = px.histogram(df, x='Productivity_remote_vs_workplace', nbins=30, title="Histogramme de la productivité")
fig.show()

print("Skewness change in productivity:")
print(df['Productivity_remote_vs_workplace'].skew())
```

The histogram we obtain from the code shows an important part of 0 meaning for a lot of people working remotely doesn’t affect their productivity. Looking at the skewness (-0.13), we can deduce that data is significantly more on the right of the graph, meaning that people are more productive being at home for work.  

## Bivariate Analysis

```{python}

import plotly.express as px
import plotly.graph_objects as go

# Ordre numérique cohérent avec le mapping précédent
org_order_num = [1, 2, 3, 4, 5]
ticktext = [
    "Solo business",
    "Micro enterprise",
    "Small enterprise",
    "Medium enterprise",
    "Large / Corporate enterprise"
]

fig = px.violin(
    df,
    x="Organisation_Size",
    y="Productivity_remote_vs_workplace",
    color="Organisation_Size",
    category_orders={"Organisation_Size": org_order_num},
    box=True,
    points=False,
    title="Productivity Change by Organisation Size",
    labels={
        "Organisation_Size": "Organisation size",
        "Productivity_remote_vs_workplace": "Productivity change (%)"
    }
)

# Moyennes par taille (en gardant l’ordre numérique)
means = (
    df.groupby("Organisation_Size", observed=False)["Productivity_remote_vs_workplace"]
      .mean()
      .reindex(org_order_num)
)

fig.add_trace(
    go.Scatter(
        x=list(range(1, 6)),       # positions 1..5
        y=means.values,
        mode="markers",
        marker=dict(symbol="diamond", size=11, color="black", line=dict(width=1)),
        name="Mean"
    )
)

fig.add_hline(y=0, line_dash="dash", opacity=0.6)

fig.update_layout(
    template="plotly_white",
    title=dict(x=0.5),
    showlegend=False,
    margin=dict(l=60, r=30, t=80, b=50),
    xaxis=dict(showgrid=False, tickmode="array", tickvals=org_order_num, ticktext=ticktext),
    yaxis=dict(zeroline=False)
)
```

In this Violin plot, we can understand that the change in productivity is not really influenced by the size of the company. Nevertheless, we can observe for small enterprises that a negative change in productivity is even rarer. We can guess that people in small businesses don’t depend too much on working with peers and with teams, so going to the workplace is less necessary than in big companies and communications facilitated. 
```{python}
male_df = df[df['Gender'] == 0]
female_df = df[df['Gender'] == 1]

male_counts = male_df['Managing_position'].value_counts()
female_counts = female_df['Managing_position'].value_counts()

labels = ['Managing', 'Not Managing']

male_values = [male_counts.get(1, 0), male_counts.get(0, 0)]
female_values = [female_counts.get(1, 0), female_counts.get(0, 0)]
fig = make_subplots(
    rows=1, cols=2,
    specs=[[{'type': 'domain'}, {'type': 'domain'}]],
    subplot_titles=['Managing Position (Male)', 'Managing Position (Female)'])

# Pie chart Men
fig.add_trace(
    go.Pie(labels=labels, values=male_values, hole=0.4),
    row=1, col=1)

# Pie chart Women
fig.add_trace(
    go.Pie(labels=labels, values=female_values, hole=0.4),
    row=1, col=2)

fig.update_layout(
    title="Managing Position by Gender",
    height=500,
    width=900)

fig.show()
```

We wanted to look at the distribution of the managing positions based on the gender and we could see that almost 60% of men are managers compared to only 40% for women so this is factored to take into consideration when giving conclusions.  

## Correlation/Multivariate Analysis 
```{python}
labels = ['Working', 'Personal & Family', 'Domestic', 'Commute']

remote_hours = [
    df['Working_hours_remote'].mean(),
    df['Personal_family_hours_remote'].mean(),
    df['Domestic_hours_remote'].mean(),
    df['Commute_hours_remote'].mean()
]

workplace_hours = [
    df['Working_hours_workplace'].mean(),
    df['Personal_family_hours_workplace'].mean(),
    df['Domestic_hours_workplace'].mean(),
    df['Commute_hours_workplace'].mean()
]

# Pie Remote
fig_remote = go.Figure(
    data=[go.Pie(labels=labels, values=remote_hours, hole=0.4)]
)
fig_remote.update_layout(title="Distribution of Remote Hours")
fig_remote.show()

# Pie Workplace
fig_workplace = go.Figure(
    data=[go.Pie(labels=labels, values=workplace_hours, hole=0.4)]
)
fig_workplace.update_layout(title="Distribution of Workplace Hours")
fig_workplace.show()
```

can see on those 2 pie charts representing the distribution of the day based on the time in hours working, commuting, for personnal and family, and domestic.  We can see that the time of work is sensibly the same for remote and workplace (50% compared to 48.8%). What is important here is to see that time to commute is divided by 3 when remote working so it gives more time for domesting and personnal/family time going from 39.6% of your day to 46%. This difference shows a better work/life balance for employees when remotely working. This could affect mental health positively.  

## Key Findings

**Univariate Analysis**
- The sample is professionally experienced: only 11% have experience of less than 1 year. 
- There is a correct balance between genders: 44% of the sample is composed by women.
- Productivity is either not affected or positively impacted by remote work: 46% improved their productivity through remote work.

**Bivariate Analysis**
Working on place or remotely does not affect small businesses productivity, from which we can conclude small-structure workers does not depend too much on working with peers and teams, and going physically to workplace is less necessary than in big companies and communications facilitated. 

Manager jobs are composed of men at a 60% rate whereas only 40% are women, a factor we must take into consideration when giving conclusions.  

**Correlation/Multivariate Analysis**
According to the distribution of the day based on the time in hours working, commuting, for personal and family, and domestic, we can observe that the time of work is sensibly the same remotely and physically at work (50% compared to 48.8%). 
Furthermore, time to commute is divided by 3 when working remotely, which gives more time for domestic activities and personal/family time going from 39.6% of daytime to 46%. This difference shows a better work/life balance for employees through remote work, an element that could positively affect mental health.  
There is a positive correlation of 0.14 between productivity and working remotely. However, this correlation coefficient remains positively low.
